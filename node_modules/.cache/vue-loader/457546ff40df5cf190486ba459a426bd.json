{"remainingRequest":"D:\\domain\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\domain\\src\\views\\Settings\\index.vue?vue&type=style&index=0&id=716db321&lang=scss&scoped=true&","dependencies":[{"path":"D:\\domain\\src\\views\\Settings\\index.vue","mtime":1613724707619},{"path":"D:\\domain\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\domain\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\domain\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\domain\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\domain\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\domain\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi55dW1pbmcgew0KICB3aWR0aDogNjZ2dzsNCiAgbWFyZ2luOiAwIGF1dG87DQogIHBhZGRpbmc6IDQxcHggMTVweDsNCiAgLnRhYmxlIHsNCiAgICBtYXJnaW4tdG9wOiAtNDVweDsNCg0KICB9DQp9DQoudGFibGV7DQogIHdpZHRoOiA2NnZ3Ow0KICBtYXJnaW46IDAgYXV0bzsNCiAgcGFkZGluZzogMTBweCAwIDIxcHggMDsNCn0NCiAgLmNvbnRlbnQgew0KICAgIHBhZGRpbmc6IDAgMjZweCAxdmggMjZweDsNCiAgICAudGFibGVUb3Agew0KICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1lbmQ7DQogICAgICBtYXJnaW46NDFweCAwIDAgMDsNCiAgICB9DQogICAgLnVzZXItY29udGVudCB7DQogICAgICAgIHdpZHRoOjYwMHB4Ow0KICAgICAgICBtYXJnaW46MCBhdXRvOyAgDQogICAgICAgIC9kZWVwLy5lbC1mb3JtIHsNCiAgICAgICAgICAuZWwtZm9ybS1pdGVtX19sYWJlbCB7DQogICAgICAgICAgICBjb2xvcjogIzg2OGU5NjsNCiAgICAgICAgICB9DQogICAgICAgICAgLmVsLWZvcm0taXRlbV9fY29udGVudCB7DQogICAgICAgICAgICBtYXJnaW4tbGVmdDozNSUhaW1wb3J0YW50Ow0KICAgICAgICAgIH0NCiAgICAgICAgICAuZWwtaW5wdXQtLXN1ZmZpeCAuZWwtaW5wdXRfX2lubmVyIHsNCiAgICAgICAgICAgIGNvbG9yOiAjODY4ZTk2Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICAuZm9vdGVyIHsNCiAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgbWFyZ2luOjMwcHggNDBweCAwIDA7DQogICAgICAgICAgc3BhbiB7DQogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogICAgICAgICAgICB3aWR0aDogNjVweDsNCiAgICAgICAgICAgIGhlaWdodDogMzhweDsNCiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAzOHB4Ow0KICAgICAgICAgICAgb3BhY2l0eTogMC43NjsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZweDsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgICAgICB9DQogICAgICAgICAgLnN1Ym1pdCB7DQogICAgICAgICAgICBib3JkZXI6IHNvbGlkIDFweCAjNTU5NWM4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzY2YWZlOTsNCiAgICAgICAgICAgIGNvbG9yOiAjZmZmOw0KICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiAyMHB4Ow0KICAgICAgICAgIH0NCiAgICAgICAgICAuYmFjayB7DQogICAgICAgICAgICBib3JkZXI6IHNvbGlkIDFweCAjODY4ZTk2Ow0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsNCiAgICAgICAgICAgIGNvbG9yOiAjODY4ZTk2Ow0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmYA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Settings","sourcesContent":["<template>\r\n  <div class=\"content\">\r\n    <div class=\"tableTop\"><el-button type=\"primary\" @click=\"openUser\">添加用户</el-button></div>\r\n    <div class=\"table\">\r\n        <Tables\r\n        :data=\"table.data\"\r\n        :columns=\"table.columns\"\r\n        :pageShow=\"false\"\r\n        :loading=\"table.loading\"\r\n         @clickButton=\"clickButton\"\r\n        :tableOption=\"table.tableOption\"\r\n      >\r\n      </Tables>\r\n    </div>\r\n    <div class=\"addUser\">\r\n      <Dailog :title=\"title\" :width=\"'35%'\" :show.sync=\"userShow\" @closeDialog=\"onCloseKey\">\r\n        <div slot=\"content\" class=\"user-content\">\r\n            <el-form :model=\"ruleForm\" :rules=\"rules\" ref=\"ruleForm\" class=\"form\">\r\n              <el-form-item label=\"用户名\" prop=\"name\" :label-width=\"formLabelWidth\">\r\n                <el-input v-model=\"ruleForm.name\" placeholder=\"请输入用户名\" @input=\"nameChange\"  style=\"width: 60%\"></el-input>\r\n              </el-form-item>\r\n              <el-form-item label=\"信箱\" prop=\"email\" :label-width=\"formLabelWidth\">\r\n                <el-input v-model=\"ruleForm.email\" placeholder=\"请输入信箱\"  @input=\"emailChange\" style=\"width: 60%\"></el-input>\r\n              </el-form-item>\r\n              <div v-if=\"!isEdit\">\r\n                <el-form-item label=\"请输入密码\" prop=\"password\"  :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"ruleForm.password\"  @input=\"pwdChange\" placeholder=\"请输入密码\" style=\"width: 60%\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"重复密码\" prop=\"password_confirmation\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"ruleForm.password_confirmation\" @input=\"pwdConChange\"  placeholder=\"请输入重复密码\"  style=\"width: 60%\"></el-input>\r\n                </el-form-item>\r\n              </div>\r\n              <div v-if=\"isEdit\">\r\n                <el-form-item label=\"请输入原密码\" prop=\"old_password\" :label-width=\"formLabelWidth\">\r\n                <el-input v-model=\"ruleForm.old_password\" placeholder=\"请输入密码\" @input=\"oldPwdChange\"  style=\"width: 60%\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"请输入新密码\" prop=\"password\" :label-width=\"formLabelWidth\">\r\n                <el-input v-model=\"ruleForm.password\" placeholder=\"请输入密码\" @input=\"pwdChange\" style=\"width: 60%\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"重复新密码\" prop=\"password_confirmation\" :label-width=\"formLabelWidth\">\r\n                    <el-input v-model=\"ruleForm.password_confirmation\" @input=\"pwdConChange\" placeholder=\"请输入重复密码\"  style=\"width: 60%\"></el-input>\r\n                </el-form-item>\r\n              </div>\r\n              <el-form-item label=\"权限\"  :label-width=\"formLabelWidth\">\r\n                  <el-select v-model=\"ruleForm.role\" placeholder=\"请选择\" style=\"width: 30%\">\r\n                     <el-option\r\n                      v-for=\"item in options\"\r\n                      :key=\"item.value\"\r\n                      :label=\"item.label\"\r\n                      :value=\"item.value\">\r\n                    </el-option>\r\n                  </el-select>\r\n              </el-form-item>\r\n            </el-form>\r\n            <div class=\"footer\">\r\n              <span class=\"submit\" @click=\"submitForm('ruleForm')\">确定</span>\r\n              <span class=\"back\" @click=\"back\">返回</span>\r\n            </div>\r\n        </div>\r\n      </Dailog>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Tables from '../../components/tables/table'\r\nimport Dailog from '../../components/dialogs/dialog'\r\nimport {getUserList,getUserInfo,addRegister,delelteUser,updateUser} from \"@/api\";\r\nimport { spawn } from 'child_process';\r\nexport default {\r\n  name:\"Settings\",\r\n  components:{Tables,Dailog},\r\n  data() {\r\n    var checkName = (rule,val,cb) => {\r\n      if(!this.ruleForm.name||this.ruleForm.name==='') {\r\n        return cb(new Error('请输入用户名'))\r\n      }else{\r\n        cb()\r\n      }\r\n\r\n    }\r\n    var checkEmail = (rule,val ,cb) => {\r\n      let reg = /^([a-zA-Z]|[0-9])(\\w|\\-)+@[a-zA-Z0-9]+\\.([a-zA-Z]{2,4})$/;\r\n      if(!this.ruleForm.email||this.ruleForm.email=='') {\r\n        return cb(new Error('请输入信箱地址'))\r\n      }else if(!reg.test(this.ruleForm.email.trim())) {\r\n        return cb(new Error('请输入正确的箱邮'))\r\n      }else{\r\n        cb()\r\n      }\r\n    }\r\n    var checkOldPwd = (rule,val,cb) => {\r\n      if(!this.ruleForm.old_password || this.ruleForm.old_password=='') {\r\n        return cb(new Error('请输入原密码'))\r\n      }else if(this.ruleForm.old_password.trim().length<8) {\r\n        return cb(new Error('原密码最少八位'))\r\n      }else{\r\n        cb()\r\n      }\r\n    }\r\n    var checkPwd1 = (rule,val,cb) => {\r\n      if(!this.ruleForm.password||this.ruleForm.password=='') {\r\n        return cb(new Error('请输入密码'))\r\n      }else if(this.ruleForm.password.trim().length<8) {\r\n        return cb(new Error('密码最少八位'))\r\n      }else{\r\n        cb()\r\n      }\r\n    }\r\n    var checkPwd2 = (rule,val,cb) => {\r\n      if(!this.ruleForm.password_confirmation||this.ruleForm.password_confirmation=='') {\r\n        return cb(new Error('请再次输入密码'))\r\n      }else if(this.ruleForm.password_confirmation.trim().length<8){\r\n        return cb(new Error('密码最少八位'))\r\n      }else if(this.ruleForm.password_confirmation.trim()!==this.ruleForm.password.trim()){\r\n        return cb(new Error('两次输入密码不一致!'))\r\n      }else{\r\n        cb()\r\n      }\r\n    }\r\n    return {\r\n      formLabelWidth:'30%',\r\n      userShow:false,\r\n      title:'添加用户',\r\n      isEdit:false,\r\n      options: [{\r\n          value: 1,\r\n          label: 'Admin'\r\n        }, {\r\n          value: 2,\r\n          label: 'Guest'\r\n        }\r\n      ],\r\n      ruleForm:{\r\n        id:null,\r\n        name:'',\r\n        email:'',\r\n        password:'',\r\n        old_password:'',\r\n        password_confirmation:'',\r\n        old_password:'',\r\n        role:1\r\n      },\r\n      rules:{\r\n        name: [\r\n            { validator: checkName, trigger: 'blur' }\r\n        ],\r\n        email: [\r\n            { validator: checkEmail, trigger: 'blur' }\r\n        ],\r\n        old_password: [\r\n            { validator: checkOldPwd, trigger: 'blur' }\r\n        ],\r\n        password: [\r\n            { validator: checkPwd1, trigger: 'blur' }\r\n        ],\r\n        password_confirmation: [\r\n            { validator: checkPwd2, trigger: 'blur' }\r\n        ],\r\n        // role: [\r\n        //     { validator: checkRole, trigger: 'change' }\r\n        // ],\r\n      },\r\n      table:{\r\n        loading: false,\r\n        page: 1,\r\n        rows: 10,\r\n        total: 0,\r\n        columns:[\r\n          {\r\n            label: \"ID\",\r\n            key: \"id\",\r\n            width:'60'\r\n          },\r\n          {\r\n            label: \"用户名\",\r\n            key: \"name\",\r\n          },\r\n          {\r\n            label: \"权限\",\r\n            key: \"role\",\r\n            width:'100',\r\n            render: (row) =>{\r\n              return row.role===1?'Admin':'Guest'\r\n            }\r\n          },\r\n          {\r\n            label: \"信箱\",\r\n            key: \"email\",\r\n          },\r\n          {\r\n            label: \"最后登录时间\",\r\n            key: \"updated_at\",\r\n          },\r\n          {\r\n            label: \"访问次数\",\r\n            key: \"visit_times\",\r\n            width:'100'\r\n          }\r\n        ],\r\n        data:[],\r\n        // 表格操作\r\n        tableOption: {\r\n          label: \"操作\",\r\n          options: [\r\n            {\r\n              label: \"编辑\",\r\n              bgColor:'#5bbfdf',\r\n              methods: \"edit\"\r\n            },\r\n            {\r\n              label: \"删除\",\r\n              bgColor:'#fac167',\r\n              methods: \"del\"\r\n            }\r\n          ]\r\n        }\r\n      },\r\n    }\r\n  },\r\n  mounted(){\r\n    this.getData()\r\n  },\r\n  methods: {\r\n    //获取用户数据\r\n    getData() {\r\n        this.table.loading = true\r\n        getUserList().then(res=>{\r\n          if(res!==undefined&&res.code===200) {\r\n            this.table.data = res.data\r\n            this.table.loading = false\r\n          }else {\r\n            let text = res.message\r\n                 this.$alert(`${text}`, '温馨提示', {\r\n                    confirmButtonText: '确定',\r\n                })\r\n            this.table.data = []\r\n            this.table.loading = false\r\n          }\r\n        \r\n      }).catch(err=>{this.table.loading = false})\r\n    },\r\n    //添加用户\r\n    openUser() {\r\n      this.userShow = true;\r\n      this.isEdit = false;\r\n      this.title = '添加新用户'\r\n      this.ruleForm.name = ''\r\n      this.ruleForm.email = ''\r\n      this.ruleForm.password = null\r\n      this.ruleForm.password_confirmation = null\r\n      this.ruleForm.role = 1\r\n     \r\n    },\r\n    submitForm(formName) {\r\n      this.$refs[formName].validate((valid) => {\r\n         if (valid) {\r\n           if(!this.isEdit) {\r\n             let formData = new FormData()\r\n            formData.append('id',this.ruleForm.id)\r\n            formData.append('name',this.ruleForm.name.trim())\r\n            formData.append('email',this.ruleForm.email.trim())\r\n            formData.append('password',this.ruleForm.password.trim())\r\n            formData.append('password_confirmation',this.ruleForm.password_confirmation.trim())\r\n            formData.append('role',this.ruleForm.role)\r\n            addRegister(formData).then(res=>{\r\n              if(res !== undefined&&res.code === 200) {\r\n                this.userShow = false\r\n                this.$message({\r\n                  message: '添加用户成功！',\r\n                  type: 'success'\r\n                })\r\n                this.getData();\r\n              }else{\r\n                let text = res.message\r\n                 this.$alert(`${text}`, '温馨提示', {\r\n                    confirmButtonText: '确定',\r\n                })\r\n              }\r\n              \r\n            })\r\n           }\r\n           if(this.isEdit){\r\n             let formData = new FormData()\r\n            formData.append('id',this.ruleForm.id)\r\n            formData.append('name',this.ruleForm.name.trim())\r\n            formData.append('email',this.ruleForm.email.trim())\r\n            formData.append('old_password',this.ruleForm.old_password.trim())\r\n            formData.append('password',this.ruleForm.password.trim())\r\n            formData.append('password_confirmation',this.ruleForm.password_confirmation.trim())\r\n            formData.append('role',this.ruleForm.role)\r\n            updateUser(formData).then(res=>{\r\n              if(res!==undefined&&res.code===200) {\r\n                 this.userShow = false\r\n                this.$message({\r\n                  message: '用户信息更新成功！',\r\n                  type: 'success'\r\n                })\r\n                this.getData();\r\n              }else{\r\n                let text = res.message\r\n                 this.$alert(`${text}`, '温馨提示', {\r\n                    confirmButtonText: '确定',\r\n                })\r\n              }\r\n            })\r\n           }\r\n           \r\n          } else {\r\n            console.log('error submit!!');\r\n            return false;\r\n          }\r\n      })\r\n    },\r\n    onCloseKey() {\r\n      this.$refs.ruleForm.resetFields()\r\n    },\r\n    back() {\r\n      this.userShow = false\r\n      this.ruleForm.name = ''\r\n      this.ruleForm.email = ''\r\n      this.ruleForm.password = null\r\n      this.ruleForm.password_confirmation = null\r\n      this.ruleForm.role = 1\r\n      this.$refs.ruleForm.resetFields()\r\n    },\r\n    clickButton(val) {\r\n      if(val.methods===\"edit\") {\r\n        this.userShow = true\r\n        this.title = '编辑'\r\n        this.isEdit = true\r\n        this.ruleForm.id = val.row.id\r\n        this.ruleForm.name = val.row.name\r\n        this.ruleForm.email = val.row.email\r\n        this.ruleForm.old_password = null\r\n        this.ruleForm.password = null\r\n        this.ruleForm.password_confirmation = null\r\n        this.ruleForm.role = val.row.role\r\n        \r\n      }\r\n      if(val.methods==='del') {\r\n         this.$confirm('此操作将永久删除该用户, 是否继续?', '温馨提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          let formData = new FormData()\r\n          formData.append('id',val.row.id)\r\n          delelteUser(formData).then(res=>{\r\n            if(res!==undefined&&res.code===200) {\r\n              this.$message({\r\n                  type: 'success',\r\n                  message: '删除用户成功!'\r\n                });\r\n                  this.getData();\r\n            }\r\n          })\r\n          \r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '已取消删除'\r\n          });          \r\n        });\r\n        \r\n      }\r\n    },\r\n    nameChange(val) {\r\n      this.ruleForm.name = val.replace(/[, ]/g,'')\r\n    },\r\n    emailChange(val) {\r\n     this.ruleForm.email = val.replace(/[, ]/g,'')\r\n    },\r\n    oldPwdChange(val) {\r\n       this.ruleForm.old_password = val.replace(/[, ]/g,'')\r\n    },\r\n    pwdChange(val) {\r\n       this.ruleForm.password = val.replace(/[, ]/g,'')\r\n    },\r\n    pwdConChange(val) {\r\n       this.ruleForm.password_confirmation = val.replace(/[, ]/g,'')\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.yuming {\r\n  width: 66vw;\r\n  margin: 0 auto;\r\n  padding: 41px 15px;\r\n  .table {\r\n    margin-top: -45px;\r\n\r\n  }\r\n}\r\n.table{\r\n  width: 66vw;\r\n  margin: 0 auto;\r\n  padding: 10px 0 21px 0;\r\n}\r\n  .content {\r\n    padding: 0 26px 1vh 26px;\r\n    .tableTop {\r\n      display: flex;\r\n      justify-content: flex-end;\r\n      margin:41px 0 0 0;\r\n    }\r\n    .user-content {\r\n        width:600px;\r\n        margin:0 auto;  \r\n        /deep/.el-form {\r\n          .el-form-item__label {\r\n            color: #868e96;\r\n          }\r\n          .el-form-item__content {\r\n            margin-left:35%!important;\r\n          }\r\n          .el-input--suffix .el-input__inner {\r\n            color: #868e96;\r\n          }\r\n        }\r\n        .footer {\r\n          text-align: center;\r\n          margin:30px 40px 0 0;\r\n          span {\r\n            display: inline-block;\r\n            width: 65px;\r\n            height: 38px;\r\n            line-height: 38px;\r\n            opacity: 0.76;\r\n            border-radius: 4px;\r\n            font-size: 16px;\r\n            text-align: center;\r\n            cursor: pointer;\r\n          }\r\n          .submit {\r\n            border: solid 1px #5595c8;\r\n            background-color: #66afe9;\r\n            color: #fff;\r\n            margin-right: 20px;\r\n          }\r\n          .back {\r\n            border: solid 1px #868e96;\r\n            background-color: #ffffff;\r\n            color: #868e96;\r\n          }\r\n        }\r\n    }\r\n  }\r\n</style>"]}]}